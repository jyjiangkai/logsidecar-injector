apiVersion: v1
data:
  server.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUR1akNDQXFLZ0F3SUJBZ0lKQU1zbTcwOFUwTEtXTUEwR0NTcUdTSWIzRFFFQkN3VUFNRTh4Q3pBSkJnTlYKQkFZVEFrTk9NUXN3Q1FZRFZRUUlEQUpJUWpFTE1Ba0dBMVVFQ2d3Q1VVTXhKakFrQmdOVkJBTU1IV3h2WjNOcApaR1ZqWVhJdGFXNXFaV04wYjNJdFlXUnRhWE56YVc5dU1CNFhEVEl4TVRFd01URXhOVE13TjFvWERUTXhNVEF6Ck1ERXhOVE13TjFvd1h6RUxNQWtHQTFVRUJoTUNRMDR4Q3pBSkJnTlZCQWdNQWtoQ01Rc3dDUVlEVlFRS0RBSlIKUXpFMk1EUUdBMVVFQXd3dGJHOW5jMmxrWldOaGNpMXBibXBsWTNSdmNpMWhaRzFwYzNOcGIyNHVhM1ZpWlMxegplWE4wWlcwdWMzWmpNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXdSVStMdHdnCndHRFZkWjN5K3dTM0RSY3VkN3pNSWtCd1M2THFmOVVOMlFBNG42R3RIakNLQjBNTjF2NVNGaUFSUmQyazBPUTEKaXMrYUdGcytFU0VqUjc4S05XOGxLVkZKZlRDV2ZwUkh4N0I1cUc4cVBDcmRQWklyTWtnVEhyZzBYazN0TUlyOApGd2NpdTRwSEhsRVBQSG9GNWhmMTNER1poTmJJYVVndFpuMGszQ2pTZzdyY1dKcVMvVXh5UXRhQklmd2s3NVRSCnFLR0Q4ZDNpMCt0b09QNHk0cVF5MGZuZDVJRCtaYjByd1ZvUUtpb1gxUXI0bjNpNmthV3ByNXJDMk1ibHQzMlMKU2ovZ2drRGNMeFhXbmZKOTNGYWIxNTR0Q3gyVWxXcWRxTTdNV1NJQ2I3b3Z5OTdETTcxdXRyVGJGQ3IxSTVrUQpxczVrUTR4VWcyYmVUUUlEQVFBQm80R0lNSUdGTUlHQ0JnTlZIUkVFZXpCNWdoMXNiMmR6YVdSbFkyRnlMV2x1CmFtVmpkRzl5TFdGa2JXbHpjMmx2Ym9JcGJHOW5jMmxrWldOaGNpMXBibXBsWTNSdmNpMWhaRzFwYzNOcGIyNHUKYTNWaVpTMXplWE4wWlcyQ0xXeHZaM05wWkdWallYSXRhVzVxWldOMGIzSXRZV1J0YVhOemFXOXVMbXQxWW1VdApjM2x6ZEdWdExuTjJZekFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBZTVuSEI1VThBSDJBd29tUXQzQ2laMnJUCks4MWJMZFNGcmhQSnc1YkNxdlBYa2NXZGNnVVZvcEsrcFZFR1B2SkZ6YlZJUG41bnJaaFgraklWOElVV28ya2gKQ2l2VVFpZCtyajcwRjMybGlPU1MySzN0Sk9VL0RLNmdRcmY3QTJLendmWkVySTY0dHBDVGo1RDB1S29BUlc0TApQOVRuZHpTL1A5RVVUUWJrK0tvRkgzOVNXVHpQTG8wOE8wTXMxenFLNU1TYkNHU3ZRTkdJMksvcVZtVkViN3hrCkRnMFdFRWkrR1hmZGJoMW1CUlBPQXhzMzJETWxGbkUyUnpETEowUStTaEhXQmxhMWc1NXpRWDNFK3kwcmxRZ1MKUVJrQjlYV0dNcmpZQjFqaDdCeGVSaWd3bFZoU21USis4dXVnU1BlRHVyT3VUWk5MMmhkMDlWSXVSTG9TVVE9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  server.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBd1JVK0x0d2d3R0RWZFozeSt3UzNEUmN1ZDd6TUlrQndTNkxxZjlVTjJRQTRuNkd0CkhqQ0tCME1OMXY1U0ZpQVJSZDJrME9RMWlzK2FHRnMrRVNFalI3OEtOVzhsS1ZGSmZUQ1dmcFJIeDdCNXFHOHEKUENyZFBaSXJNa2dUSHJnMFhrM3RNSXI4RndjaXU0cEhIbEVQUEhvRjVoZjEzREdaaE5iSWFVZ3RabjBrM0NqUwpnN3JjV0pxUy9VeHlRdGFCSWZ3azc1VFJxS0dEOGQzaTArdG9PUDR5NHFReTBmbmQ1SUQrWmIwcndWb1FLaW9YCjFRcjRuM2k2a2FXcHI1ckMyTWJsdDMyU1NqL2dna0RjTHhYV25mSjkzRmFiMTU0dEN4MlVsV3FkcU03TVdTSUMKYjdvdnk5N0RNNzF1dHJUYkZDcjFJNWtRcXM1a1E0eFVnMmJlVFFJREFRQUJBb0lCQUE2aGMzTE5qMVhFZ0toRwo3YkNEclBNNi9IUnFRL1djZUdYaTFHNFhVTk5PcHZ2Qm5vS1pIdnhwNGxTV05OWWtXK3ExWHRYTlZSbE5uZG1XCm9GOWY2WEo0VVdlM0lsTzlLeHBuWWgvNVVHOGJPankvSDY0cmVWUS9EVExrTHo2MnFwRXl5blJSTThUeTczalMKZzQwU2kxc0R6QXFoYWlualFFVEdtYTBRb1JBUTdkWmZvOUQ4c09oUmhJWXRLZEx2MnJnNTlPOWx1TkdqTEF2agpSNjE0OXc0dkhhclVRSW9rNTNsbzBjWHNTVUhRMEJZYVZ5WGh5WmpBNTcxMHJPbmtadWYzTVhGZUdGODRaY25RClA0VzFMejh5bUtKWG9iTTJLNk1qcEZDcmhEVi9hZzEyVXExL09kYWkyQzdyOWZ3OWVvSDFZUVFXQ0Q1R1lMZGUKdDhQNDhTa0NnWUVBMzVPRTJTN2g3UTdybEZNRlMxN0FQdzR5VmxCaDVacVA1UnVOOFdRZ2ZOSjZnZkFFbzdibQptVjNZbUJBOERlR0VPVFRNTkJEQUFFR0dydnAvbktmcW1tREwwR0w3M2lGUnAycW0vTFlKRGhRT0Z3RTMrVE5nClVmckpMck16Qy9RNkxZdlNRcit3Z3FJZUdOeGlhT1RBNFloeHVubHZoZFkrc0NsVXN1MDljTjhDZ1lFQTNSV2gKNXZKMmVvWjl4YXFBRUU2QS9FWVJGOXRnUm9IMGRZckdIbzVoYTM3d3g2SUFuQk41ZGVVdnRlUEg0dVV4WmdQOApNRUdkbEw1UnNwaDNzQnRRQnRhNXYyc0JxbWFMbXp2SnBKcTZRTmFCSDhWYUJQVGZrOXRGRUdXVGw5YlVYQ2RNCnBnWlduOFJlZUk0eXFkZjE1U2txTFg3T1IrYmhuaWVtVGFCdmVsTUNnWUJSckcwNmZhTHcyNk41b3I1cll5aXQKb0QwSlJRSU9RMkZQbTdwRnRZTWN0ak1rcG82N1U4UjN3RTJ3ZHpYSkNGb3FIN3g5UktVdk1zREZ5U0szRXF4awpTdm9KblM5UFhUS2NDeDBIY21ScWJTOGNma2g1VTZoYktsYzJKU1ovdG05T1ZpYXdWYUJnaUdLZ1NGbjI0YUlJCmdiU3lIMHg3UXVIUnJyZVBTWlZKVndLQmdRQ2E5SVNMaURsK1d6RmdEOGErcHlkRXFoOWs1eit0YTN4WnZqQnEKVGtUOXdQVW1GdWZ5Zkx2TzVCbnlsSG9QRDdEMTNha3VjVzd2U0EyZTdicEYxbjdhckRsNGJwbTJRelZxVWhkYwpwWTRSejhhazYvL1NKWWRtN0hLVnNYd25HazJ4WVdJWm82dW5RMDBybGc3d2VBdEMyUDFVOGVISEI0M3UrYjlYCi9URGxQUUtCZ0h1ZytaZVJGWHZXSWEvWFRhVmFCUTJqWlRsN3dRL0dpMUxjbnZIU293cnlnUGZ0ZHljaTFKa3UKaVJzOFBGK0RxKzN4T0ZlalJyM21aV0x5V3pueU9kWEJ6TVNxMys5TlRSVElNQmxKTVl1RWtZUVkvaUlMcmVpLwp4TFNrbU5jdkVuRTEwam50SHM5VVdtc3E0WHZMT1VhWUJPSm1HMldRZHRkNkpGVjhQNm5WCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==
kind: Secret
metadata:
  name: admission-certs
  namespace: system
---
apiVersion: v1
kind: Service
metadata:
  name: admission
  namespace: system
spec:
  ports:
    - port: 443
      protocol: TCP
      targetPort: 8443
  selector:
    logging.kubesphere.io/logsidecar-injector: $(INJECTOR_DEPLOY_NAME)
---
apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  name: admission-mutate
webhooks:
  - admissionReviewVersions:
      - v1beta1
    name: logsidecar-injector.logging.kubesphere.io
    failurePolicy: Fail
    rules:
      - apiGroups:
          - ""
        apiVersions:
          - v1
        operations:
          - CREATE
        resources:
          - pods
    clientConfig:
      service:
        namespace: $(ADMISSION_SERVICE_NAMESPACE)
        name: $(ADMISSION_SERVICE_NAME)
      caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURmekNDQW1lZ0F3SUJBZ0lVTE5JRUV5K2crcm4vaG9YQzdacmZCcXowUDJZd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1R6RUxNQWtHQTFVRUJoTUNRMDR4Q3pBSkJnTlZCQWdNQWtoQ01Rc3dDUVlEVlFRS0RBSlJRekVtTUNRRwpBMVVFQXd3ZGJHOW5jMmxrWldOaGNpMXBibXBsWTNSdmNpMWhaRzFwYzNOcGIyNHdIaGNOTWpFeE1UQXhNVEUxCk16QTNXaGNOTXpFeE1ETXdNVEUxTXpBM1dqQlBNUXN3Q1FZRFZRUUdFd0pEVGpFTE1Ba0dBMVVFQ0F3Q1NFSXgKQ3pBSkJnTlZCQW9NQWxGRE1TWXdKQVlEVlFRRERCMXNiMmR6YVdSbFkyRnlMV2x1YW1WamRHOXlMV0ZrYldsegpjMmx2YmpDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTTBDZ2RrVjZMSFV3YkpFCjBrcFUyVElNc3I1YUFVeDB5Yk1EVGZTWW9BZ1pBNlNzcDRCdUxJVFMyZ1pUTk81NzdPV2tFbHNqck1kTlo3SFYKVmRWNUpmSmhVdldZclFOQlZVcmdNdDFvRkVodnRwSjdxRTV0RlBPSFV1VmNHTmJoRHJBZWtNZ21IVjFhQms4bwphQ1lJZDRmWW1NSm1DbkJLbm41WFVuUDV1WHhGWUxhRUZxRDJYNVdENnFFVXRobW9zdnY2V2h1bm00UURReWR6CjYxeHcyVTYzbFRrUGR3QURmdXdYVFFJOUt6N2R0SXVjZlBRcFlQeUlhaStodHltMGdnb085NEpWTDFFMEYyRXYKUVdtK3N6QU9xZHB2UDFtcXRPTStYNXVCT0pjV3NlTm9XWXh1empzUWNmbjhmV09GNjMyeW5tTlFaYUVyVnZtTQpvV1JqdStjQ0F3RUFBYU5UTUZFd0hRWURWUjBPQkJZRUZBODZpTkpaVUhtK2FKOEsxUzBhR1BMbmxVKzlNQjhHCkExVWRJd1FZTUJhQUZBODZpTkpaVUhtK2FKOEsxUzBhR1BMbmxVKzlNQThHQTFVZEV3RUIvd1FGTUFNQkFmOHcKRFFZSktvWklodmNOQVFFTEJRQURnZ0VCQUJDNVdvcy9HU3lPSWVjTTdjSEliY21Jemd2QndHVmQ3T2wyRlA5UQpCRmtOMk9Hbm5aWnBLQlJSR3ZYM3FRRVdOeXlOWElLMUFxVFVBUm1WaWJmYjZGOFRVVkZRbFV2YzJ4Q0ZJbGlmCmlZY1hnWEJUT3J3NU9CTFdxbDNhQjdWR3FCN1BEKzNMMmFqQTFOb0FmSWRpdnhlMXpibmhFRy9pZmpiMkdBUW8KU25QdlZuNnRMWkFyc3A5em9raWdHQ2hRNGU1VlJrZ1g1Q1BUOERVK0RpdTAvejFwY3lqc3FBeHNraklLNnV2UwprTkNySy9Na056UVUzTDNBSDliYS9GN3NLanFYODcrMHRpYVVHdXVsYjJBY29rZjRaeDNYRUEwSVVhVHpUT3NuClhZSm12VXdqcGVWeTA0TC9ZYlYzRGhhLzArQjNJQ1NUTUJuWXNjYlJjUUtoc2N3PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
    namespaceSelector:
      matchExpressions:
      - key: logging.kubesphere.io/logsidecar-injection
        operator: In
        values:
        - enabled
    objectSelector:
      matchExpressions:
      - key: logging.kubesphere.io/logsidecar-injector
        operator: DoesNotExist
    sideEffects: None
